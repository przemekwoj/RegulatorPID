package com.przemo.RegulatorPID_1;

import java.io.IOException;

import javax.bluetooth.DiscoveryAgent;
import javax.bluetooth.LocalDevice;
import javax.bluetooth.RemoteDevice;
import javax.bluetooth.UUID;
import javax.microedition.io.Connector;
import javax.microedition.io.StreamConnection;
import javax.microedition.io.StreamConnectionNotifier;
import java.io.InputStream;
import java.io.OutputStream;


public class MyThread implements Runnable
{

	public void run() 
	{
		
		LocalDevice localDevice;
		DiscoveryAgent agent;
		
		//create a UUID for SPP
		UUID uuid = new UUID(0x1101);
		//create the service url
		String connectionString = "btspp://localhost:"+uuid+";name=SampleSPPServer";
		
		try 
		{/*
			//open server url
			StreamConnectionNotifier streanConnNotifier = (StreamConnectionNotifier) Connector.open(connectionString);
			//wait for client connection
			System.out.println("Server started. Wait for client to connect...");
			
			StreamConnection connection = streanConnNotifier.acceptAndOpen();
			RemoteDevice dev = RemoteDevice.getRemoteDevice(connection);
			System.out.println("remote device adress :"+dev.getBluetoothAddress());
			System.out.println("remote device name :"+ dev.getFriendlyName(true));
			*/
			boolean scanFinished = false;
			String hc05Url =
			"btspp://201503027142:1;authenticate=false;encrypt=false;master=false"; //Replace this with your bluetooth URL
			StreamConnection streamConnection ;
					OutputStream os ;
					InputStream is ;
					while(true)
					{
					streamConnection = (StreamConnection)Connector.open(hc05Url);
					os = streamConnection.openOutputStream();
					is = streamConnection.openInputStream();
					int x = 20;
					os.write(x); //'1' means ON and '0' means OFF
					os.close();
					//byte[] b = new byte[200];
					//byte[] readBuffer = new byte[1024];
					//int numBytes = is.read(readBuffer);
					int length = is.available();
					byte[] b = new byte[1024];	
					int dlugosc = 0;
					for(int i=0;i<1024;i++)
					{
						System.out.println("b["+i+"] : " + b[i]);
						if(b[i]!=0)
						{
							dlugosc++;
						}
						else
						{
							//break;
						}
					}
					byte[] b2 = new byte[dlugosc];	
					for(int i =0;i<dlugosc;i++)
					{
						b2[i]=b[i];
					}
					//byte[] b2 = IOUtils.toByteArray(inpustream);
					Thread.sleep(200);
					//is.read(b);
					is.close();
					
					streamConnection.close();
					System.out.println("received " + new String(b2));
					}
			

		} catch (IOException e) 
		{
			e.printStackTrace();
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		System.out.println("here6");

		System.out.println("serverStarted");	
	}

}
